import{j as e,r as u,u as me,L as xe,F as I,f as ge,a as K,b as fe,c as be,d as A,w as je,y as x,e as X,g as Z,h as J,B as ye,i as Q,R as ve,k as V,l as we,P as Ne,m as ke,n as Se,M as Ce}from"./vendor-1VvdGqWE.js";(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const t of o.addedNodes)t.tagName==="LINK"&&t.rel==="modulepreload"&&r(t)}).observe(document,{childList:!0,subtree:!0});function c(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(s){if(s.ep)return;s.ep=!0;const o=c(s);fetch(s.href,o)}})();function Pe({progress:n}){const l=Math.max(0,Math.min(n,100));return e.jsx("div",{className:"progress-bar-container",children:e.jsx("div",{className:"progress-bar-fill",style:{width:`${l}%`}})})}function Y({data:n}){const[l,c]=u.useState(1),r=20,s=Math.ceil(n.length/r),o=()=>{c(b=>Math.max(b-1,1))},t=()=>{c(b=>Math.min(b+1,s))},h=(l-1)*r,k=n.slice(h,h+r);return e.jsxs("div",{className:"mt-6 bg-white p-4 rounded-md shadow",children:[e.jsx("h2",{className:"text-lg font-semibold mb-2 parsedHead",children:"Parsed Data Preview:"}),e.jsx("h4",{className:"parsedSubHead",children:"Here is a quick glance at your extracted spreadsheet data."}),e.jsx("div",{className:"parsed-preview-wrapper",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"parsed-preview-table",children:[e.jsx("thead",{children:e.jsx("tr",{children:Object.keys(n[0]||{}).map(b=>e.jsx("th",{className:"text-left font-medium text-gray-600 pr-4 pb-2",children:b},b))})}),e.jsx("tbody",{children:k.map((b,D)=>e.jsx("tr",{children:Object.values(b).map((R,S)=>e.jsx("td",{className:"pr-4 py-1 text-gray-700",children:R},S))},h+D))})]})})}),e.jsxs("div",{className:"flex justify-between mt-4 items-center paginationPage",children:[e.jsx("button",{onClick:o,disabled:l===1,className:"px-3 py-1 bg-gray-300 rounded disabled:opacity-50",children:"Previous"}),e.jsxs("span",{className:"mx-4 self-center",children:["Page ",l," of ",s]}),e.jsx("button",{onClick:t,disabled:l===s,className:"px-3 py-1 bg-gray-300 rounded disabled:opacity-50",children:"Next"})]})]})}function Ie({currentStep:n,onStepClick:l,completedStep:c}){const r=[{id:1,label:"Select files"},{id:2,label:"Upload"},{id:3,label:"Process"},{id:4,label:"Results"}],o={upload:1,viewFileData:2,execute:3,process:4}[n]||1;return e.jsx("div",{className:"step-progress-container",style:{marginBottom:"1.5rem"},children:e.jsx("div",{className:"step-progress-bar",style:{display:"flex",justifyContent:"space-between",position:"relative",margin:"0 1rem",paddingTop:"1rem",paddingBottom:"1rem"},children:r.map((t,h)=>{const k=t.id<=c+1;return e.jsxs("div",{className:"step-item",style:{textAlign:"center",flex:1,position:"relative"},children:[e.jsx("div",{className:`step-circle ${t.id<=o?"active":""}`,style:{width:"24px",height:"24px",borderRadius:"50%",backgroundColor:t.id<=o?"#ea580c":"#d1d5db",margin:"0 auto",zIndex:2,position:"relative"}}),h!==r.length-1&&e.jsx("div",{className:`step-line ${t.id<o?"active":""}`,style:{position:"absolute",top:"12px",left:"0%",width:"100%",height:"4px",backgroundColor:t.id<o?"#ea580c":"#d1d5db",zIndex:1,transform:"translateX(50%)"}}),e.jsx("div",{className:"step-label",onClick:()=>k&&l&&l(t.id),style:{marginTop:"8px",fontSize:"0.875rem",color:t.id<=o?"#ea580c":"#6b7280",fontWeight:t.id===o?"600":"400",cursor:k?"pointer":"default",userSelect:"none"},children:t.label})]},t.id)})})})}function De(){const[n,l]=u.useState(null),[c,r]=u.useState(0),[s,o]=u.useState([]),[t,h]=u.useState("upload"),[k,b]=u.useState("google_ads"),[D,R]=u.useState("Google"),[S,F]=u.useState(!1),[T,_]=u.useState(!1),[g,C]=u.useState(!1),[ee,$]=u.useState(!1),[E,L]=u.useState(0),[M,B]=u.useState(null),[O,U]=u.useState(!1),[te,q]=u.useState(!1),j={1:"upload",2:"viewFileData",3:"execute",4:"process"},se=i=>{const a=j[i];a&&i<=P+1&&h(a)},oe=()=>{const i=Object.keys(j).find(p=>j[p]===t),a=parseInt(i)-1;a>=1&&h(j[a])},W=()=>{const i=Object.keys(j).find(p=>j[p]===t),a=parseInt(i)+1;a<=Object.keys(j).length&&h(j[a])},ae=()=>{const i=A.json_to_sheet(s),a=A.book_new();A.book_append_sheet(a,i,"ProcessedData"),je(a,"final_output_processed_data.xlsx")},re=async i=>{F(!0),_(!1),r(0);try{const a="mdcproject",p="raw/",m="?sv=2024-11-04&ss=bfqt&srt=sco&sp=rwdlacupyx&se=2025-06-30T14:24:00Z&st=2025-05-05T06:24:00Z&spr=https,http&sig=K3Xnawpkic7Gl66pk7Sy0KVo1DbBCNaSIfpciq4XJ5o%3D",f="daalabsadls001",v=`${p}/${k}/${i.name}`,y=`https://${f}.blob.core.windows.net/${a}/${v}${m}`,d=new XMLHttpRequest;d.open("PUT",y,!0),d.setRequestHeader("x-ms-blob-type","BlockBlob"),d.setRequestHeader("Content-Type",i.type||"application/octet-stream"),d.upload.onprogress=N=>{if(N.lengthComputable){const z=Math.round(N.loaded/N.total*100);r(z)}},d.onload=()=>{d.status>=200&&d.status<300?(_(!0),h("execute")):x.error(`Upload failed: ${d.statusText}`),F(!1)},d.onerror=()=>{x.error("Network error during upload"),F(!1)},d.send(i)}catch(a){console.error("Upload to Azure failed:",a),x.error(a.message||"Upload failed"),F(!1)}},ne=async()=>{if(!["Google","Meta","Neilsen","Amazon","Walmart","Circana","LinkedIn","Tiktok","Snapchat","Youtube","Twitter"].includes(D)){x.error(`Notebook for source "${D}" not found.`);return}C(!0);try{const p=await fetch("https://c5imdcapp.azurewebsites.net/run-notebook",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fileName:n.name,source:D})}),m=await p.json();if(p.ok){if(console.log("Notebook execution result:",m),!m.run_id){x.error("No runId returned from notebook execution."),C(!1);return}L(0),U(!1);const f=setInterval(async()=>{try{const y=await fetch(`https://c5imdcapp.azurewebsites.net/run-status/${m.run_id}`),d=await y.json();y.ok?(console.log("Run status:",d),d.status==="completed"?(clearInterval(f),L(100),C(!1),U(!0),h("process"),x.success("Notebook run completed successfully!")):d.status==="failed"?(clearInterval(f),L(0),C(!1),x.error("Notebook run failed.")):typeof d.progress=="number"&&L(d.progress)):console.error("Failed to get run status:",d)}catch(v){console.error("Error polling run status:",v)}},3e3);B(f)}else console.error("Notebook execution failed:",m),x.error("Notebook execution failed."),C(!1)}catch(a){console.error("Error executing notebook:",a),x.error("An error occurred while executing the notebook."),C(!1)}};u.useEffect(()=>{t!=="execute"&&(L(0),M&&(clearInterval(M),B(null)))},[t]),u.useEffect(()=>()=>{M&&clearInterval(M)},[M]),u.useEffect(()=>{(async()=>{if(t==="process"){q(!0),o([]),l(null);try{const a="daalabsadls001",p="mdcproject",m="?sv=2024-11-04&ss=bfqt&srt=sco&sp=rwdlacupyx&se=2025-06-30T14:24:00Z&st=2025-05-05T06:24:00Z&spr=https,http&sig=K3Xnawpkic7Gl66pk7Sy0KVo1DbBCNaSIfpciq4XJ5o%3D",v=`https://${a}.blob.core.windows.net/${p}/output/MMM_Data_Cube/MMM_Data_Cube.csv${m}`,y=await fetch(v);if(!y.ok)throw new Error(`Failed to fetch processed data: ${y.statusText}`);const d=await y.text(),N=X(d,{type:"string"}),z=N.SheetNames[0],pe=N.Sheets[z],he=A.sheet_to_json(pe);o(he)}catch(a){console.error("Error fetching processed data:",a),x.error("Failed to load processed data.")}finally{q(!1)}}})()},[t]);const le=i=>{const a=i[0];l(a),r(0),$(!0),h("viewFileData");const p=new FileReader;p.onload=m=>{try{r(40);const f=new Uint8Array(m.target.result),v=X(f,{type:"array"}),y=v.SheetNames[0],d=v.Sheets[y],N=A.sheet_to_json(d);r(100),o(N),$(!1)}catch(f){console.error("Error parsing the file:",f),r(0),$(!1),x.error("Failed to parse the Excel file.")}},p.readAsArrayBuffer(a)},{getRootProps:ie,getInputProps:ce,isDragActive:H}=me({onDrop:le,accept:".xlsx,.csv",onDropRejected:()=>x.error("Please upload a valid Excel or CSV file.")}),G=Object.keys(j).find(i=>j[i]===t),de=G==="1",ue=G==="4";let P=0;s.length>0&&(P=1),T&&(P=2),O&&(P=3),t==="process"&&(P=4);let w=!1;return t==="upload"?w=s.length===0:t==="viewFileData"?w=!T||S:t==="execute"?w=!O||g:t==="process"&&(w=!0),e.jsxs("div",{className:"upload-container min-h-screen flex items-center justify-center bg-gray-50",children:[e.jsx(xe,{}),e.jsxs("div",{className:"upload-card",style:{width:"100%",maxWidth:"100%"},children:[e.jsx(Ie,{currentStep:t,onStepClick:se,completedStep:P}),e.jsxs("div",{className:"navigation-buttons",style:{display:"flex",justifyContent:t==="upload"?"flex-end":"space-between",marginBottom:"1rem",flexDirection:"column"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:t==="upload"?"flex-end":"space-between",marginBottom:"1rem"},children:[!de&&e.jsxs("button",{onClick:oe,className:`back-button mb-2 px-3 py-1 bg-gray-300 rounded disabled:cursor-not-allowed disabled:hover:bg-gray-300 ${t!=="execute"?"btn-nav hover:bg-gray-400":""}`,disabled:g,children:[e.jsx(I,{icon:ge,style:{marginRight:"0.5rem"}}),"Back"]}),t==="viewFileData"?T?e.jsxs("button",{onClick:W,className:`next-button-top mb-2 px-3 py-1 bg-blue-600 text-white rounded disabled:cursor-not-allowed disabled:hover:bg-blue-600 ${t!=="execute"&&!w&&!g?"btn-nav hover:bg-blue-700":""}`,disabled:w||g,children:["Next",e.jsx(I,{icon:K,style:{marginLeft:"0.5rem"}})]}):e.jsxs("button",{onClick:()=>re(n),className:"next-button px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 relative overflow-hidden",disabled:S,style:{position:"relative"},children:[e.jsx(I,{icon:fe,style:{marginRight:"0.5rem"}}),e.jsx("span",{style:{position:"relative",zIndex:2},children:S?`Uploading... ${c}%`:"Next: Upload to Azure"}),S&&e.jsx("div",{style:{position:"absolute",top:0,left:0,height:"100%",width:`${c}%`,backgroundColor:"#ea580c4d",zIndex:1,transition:"width 0.3s ease",borderRadius:"0.375rem"}})]}):!ue&&e.jsxs("button",{onClick:W,className:`next-button-top mb-2 px-3 py-1 bg-blue-600 text-white rounded disabled:cursor-not-allowed disabled:hover:bg-blue-600 ${!w&&!g?"btn-nav hover:bg-blue-700":""}`,disabled:w||g,children:["Next",e.jsx(I,{icon:K,style:{marginLeft:"0.5rem"}})]})]}),e.jsx("hr",{style:{border:"1px solid #f0efef",width:"100%"}})]}),t==="upload"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"select-wrapper mt-4",children:[e.jsx("label",{htmlFor:"selectOption",className:"select-label",children:"Choose your data source:"}),e.jsxs("select",{id:"selectOption",value:k,onChange:i=>{const a=i.target.selectedIndex,p=i.target.options[a].getAttribute("data-id");b(i.target.value),R(p)},className:"select-input",children:[e.jsx("option",{value:"google_ads","data-id":"Google",children:"Google Ads"}),e.jsx("option",{value:"meta","data-id":"Meta",children:"Meta"}),e.jsx("option",{value:"neilsen","data-id":"Neilsen",children:"Neilsen"}),e.jsx("option",{value:"Amazon","data-id":"Amazon",children:"Amazon"}),e.jsx("option",{value:"Walmart","data-id":"Walmart",children:"Walmart"}),e.jsx("option",{value:"Circana","data-id":"Circana",children:"Circana"}),e.jsx("option",{value:"LinkedIn","data-id":"LinkedIn",children:"LinkedIn"}),e.jsx("option",{value:"Tiktok","data-id":"Tiktok",children:"Tiktok"}),e.jsx("option",{value:"Snapchat","data-id":"Snapchat",children:"Snapchat"}),e.jsx("option",{value:"Youtube","data-id":"Youtube",children:"Youtube"}),e.jsx("option",{value:"Twitter","data-id":"Twitter",children:"Twitter"})]})]}),e.jsxs("div",{...ie(),className:`upload-dropzone ${H?"active":""}`,children:[e.jsx("input",{...ce()}),H?e.jsx("p",{children:"Drop the file here ..."}):e.jsx("p",{children:"Drag 'n' drop an Excel or CSV file here, or click to select file"})]})]}),t==="viewFileData"&&e.jsx(e.Fragment,{children:ee?e.jsx("div",{className:"spinner-wrapper",style:{display:"flex",justifyContent:"center",marginTop:"2rem"},children:e.jsx("div",{className:"spinner-border",role:"status",style:{width:"3rem",height:"3rem",border:"0.4em solid #f3f3f3",borderTop:"0.4em solid #ea580c",borderRadius:"50%",animation:"spin 1s linear infinite"}})}):e.jsx(e.Fragment,{children:e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:e.jsx(Y,{data:s})})})}),t==="execute"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"1rem",padding:"0 1rem"},children:[e.jsxs("div",{style:{flex:1},children:[e.jsx("h3",{children:"File Information"}),e.jsxs("p",{children:[e.jsx("strong",{children:"Filename:"})," ",n?n.name:"N/A"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"File Size:"})," ",n?(n.size/1024).toFixed(2)+" KB":"N/A"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Rows:"})," ",s.length]})]}),e.jsxs("div",{style:{flex:1,textAlign:"right"},children:[e.jsx("h3",{children:"Logs"}),e.jsx("p",{children:g?`Processing row ${Math.floor(E/100*s.length)} of ${s.length}`:"Logs will appear here..."})]})]}),e.jsx("button",{onClick:ne,className:"execute-button",disabled:g,style:{position:"relative"},children:g?`Executing... ${E}%`:"Execute"}),g&&e.jsx(Pe,{progress:E})]}),t==="process"&&!g&&e.jsx(e.Fragment,{children:te?e.jsx("div",{className:"spinner-wrapper",style:{display:"flex",justifyContent:"center",marginTop:"2rem"},children:e.jsx("div",{className:"spinner-border",role:"status",style:{width:"3rem",height:"3rem",border:"0.4em solid #f3f3f3",borderTop:"0.4em solid #ea580c",borderRadius:"50%",animation:"spin 1s linear infinite"}})}):e.jsxs(e.Fragment,{children:[e.jsx(Y,{data:s,title:"Processed Data Preview:",subtitle:"Below is the Processed data ready for review and interpretation."}),e.jsx("div",{className:"text-center mt-8 download_btn",children:e.jsxs("button",{onClick:ae,className:"download-button",children:[e.jsx(I,{icon:be,style:{marginRight:"0.5rem"}}),"Download Processed Data"]})})]})})]})]})}const Le=""+new URL("bg-bg-img-B1d83LPB.png",import.meta.url).href,Me=({setUsername:n})=>{const{instance:l,accounts:c}=Z(),r=J();u.useEffect(()=>{if(c&&c.length>0){const{name:o,username:t}=c[0];localStorage.setItem("username",o),localStorage.setItem("useremail",t),n(o),r("/")}},[c,r,n]);const s=()=>{l.loginPopup({scopes:["user.read"]}).then(o=>{const{name:t,username:h}=o.account;localStorage.setItem("username",t),localStorage.setItem("useremail",h),n(t),r("/")}).catch(o=>{console.error("Login error:",o)})};return e.jsx("div",{className:"bg-white min-h-screen flex flex-col",children:e.jsx("main",{className:"main-content",children:e.jsxs("div",{className:"content-wrapper",children:[e.jsx("div",{className:"logo-section",children:e.jsx("img",{src:Le,alt:"Illustration"})}),e.jsxs("form",{"aria-label":"Login form",className:"login-form",children:[e.jsxs("h1",{className:"title",children:["Welcome to MDC Application ",e.jsx("span",{children:"👋"})]}),e.jsx("p",{className:"subtitle",children:"Log in your account"}),e.jsxs("button",{type:"button",onClick:s,className:"ms-login-button","aria-label":"Sign in with Microsoft",children:[e.jsx("i",{className:"fab fa-microsoft"}),e.jsx("span",{children:"Sign in With Microsoft"})]})]})]})})})};function Ae(){return e.jsx(ye,{children:e.jsx(Fe,{})})}function Fe(){const{instance:n}=Z(),[l,c]=u.useState(localStorage.getItem("username")||"User"),[r,s]=u.useState(!1),o=Q();return e.jsxs(e.Fragment,{children:[o.pathname!=="/login"&&e.jsx(Re,{username:l,setUsername:c,msalInstance:n,showDropdown:r,setShowDropdown:s}),e.jsx("main",{className:"p-4",children:e.jsxs(ve,{children:[e.jsx(V,{path:"/",element:e.jsx(De,{})}),e.jsx(V,{path:"/login",element:e.jsx(Me,{setUsername:c})})]})})]})}function Re({username:n,setUsername:l,msalInstance:c,showDropdown:r,setShowDropdown:s}){return Q().pathname==="/login"?e.jsx("header",{style:{textAlign:"center"},children:e.jsx("div",{className:"header-title",style:{textAlign:"center",width:"100%"},children:"MDC Application"})}):e.jsxs("header",{children:[e.jsx("div",{className:"header-title",children:"MDC Application"}),e.jsxs("div",{className:"welcome-text",onMouseEnter:()=>s(!0),onMouseLeave:()=>s(!1),style:{position:"relative",display:"inline-block"},children:[e.jsx(I,{icon:we,style:{marginRight:"0.5rem",color:"#4b5563"}}),e.jsxs("span",{children:[n,"!"]}),r&&e.jsx(Te,{onLogout:()=>l(""),msalInstance:c})]})]})}function Te({onLogout:n,msalInstance:l}){const c=J(),r=()=>{l.logoutPopup().then(()=>{localStorage.removeItem("username"),localStorage.removeItem("useremail"),n(),c("/login")}).catch(s=>{console.error(s)})};return e.jsx("div",{className:"dropdown-menu",style:{position:"absolute",top:"100%",width:"150px",left:0,backgroundColor:"white",border:"1px solid #ccc",boxShadow:"0 4px 6px rgba(0, 0, 0, 0.1)",padding:"0.5rem",zIndex:1e3},children:e.jsx("button",{onClick:r,style:{background:"none",border:"none",color:"red",cursor:"pointer"},children:"Logout"})})}const $e={auth:{clientId:"b4c5ea3f-650e-4960-a1a0-d2894c28eed5",authority:"https://login.microsoftonline.com/b5af2451-e21b-4aa2-b4b5-dc5907908dd8",redirectUri:"http://localhost:3000/auth/callback"}},Ee=new Ne($e);ke.createRoot(document.getElementById("root")).render(e.jsx(Se.StrictMode,{children:e.jsx(Ce,{instance:Ee,children:e.jsx(Ae,{})})}));
